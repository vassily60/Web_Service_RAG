<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synonym Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .action-buttons {
            white-space: nowrap;
        }
        .synonym-table {
            width: 100%;
        }
        .add-button {
            margin-bottom: 20px;
        }
        
        /* Custom table header style to match button color */
        .table thead {
            background-color: #54b6ac;
            color: white;
        }
        
        /* Override Bootstrap's thead-dark class */
        .thead-dark th {
            background-color: #54b6ac !important;
            border-color: #54b6ac !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 mb-4">
                <h1>Synonym Management</h1>
                <p>Manage synonyms for improved search functionality</p>
                
                <div class="alert alert-success" id="successAlert" style="display: none;">
                    Operation completed successfully!
                </div>
                
                <div class="alert alert-danger" id="errorAlert" style="display: none;">
                    An error occurred. Please try again.
                </div>
                
                <button class="btn btn-primary add-button" data-toggle="modal" data-target="#addSynonymModal">
                    <i class="bi bi-plus-circle"></i> Add New Synonym
                </button>
                
                <button class="btn btn-secondary ml-2 mb-3" id="refreshSynonymsBtn">
                    <i class="bi bi-arrow-clockwise"></i> Refresh Synonyms
                </button>
                
                <div class="table-responsive">
                    <table class="table table-striped table-bordered synonym-table">
                        <thead class="thead-dark">
                            <tr>
                                <th>Keyword</th>
                                <th>Synonyms</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="synonymTableBody">
                            <!-- Synonym data will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div class="navigation mt-4">
                    <button class="btn btn-secondary" onclick="location.href='/welcome'">Back to the Hub</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Synonym Modal -->
    <div class="modal fade" id="addSynonymModal" tabindex="-1" role="dialog" aria-labelledby="addSynonymModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSynonymModalLabel">Add New Synonym</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addSynonymForm">
                        <div class="form-group">
                            <label for="synonymKeyword">Keyword</label>
                            <input type="text" class="form-control" id="synonymKeyword" required>
                            <small class="form-text text-muted">The primary keyword</small>
                        </div>
                        <div class="form-group">
                            <label for="synonymList">Synonyms</label>
                            <textarea class="form-control" id="synonymList" rows="3" required></textarea>
                            <small class="form-text text-muted">Enter synonyms separated by or</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSynonymBtn">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Synonym Modal -->
    <div class="modal fade" id="editSynonymModal" tabindex="-1" role="dialog" aria-labelledby="editSynonymModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editSynonymModalLabel">Edit Synonym</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editSynonymForm">
                        <input type="hidden" id="editSynonymId">
                        <div class="form-group">
                            <label for="editSynonymKeyword">Keyword</label>
                            <input type="text" class="form-control" id="editSynonymKeyword" required>
                            <small class="form-text text-muted">The primary keyword</small>
                        </div>
                        <div class="form-group">
                            <label for="editSynonymList">Synonyms</label>
                            <textarea class="form-control" id="editSynonymList" rows="3" required></textarea>
                            <small class="form-text text-muted">Enter synonyms separated by or</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateSynonymBtn">Update</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteSynonymModal" tabindex="-1" role="dialog" aria-labelledby="deleteSynonymModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteSynonymModalLabel">Confirm Delete</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this synonym?</p>
                    <p id="deleteSynonymName" class="font-weight-bold"></p>
                    <input type="hidden" id="deleteSynonymId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Load synonyms on page load
            loadSynonyms();
            
            // Add refresh button click handler
            $('#refreshSynonymsBtn').click(function() {
                loadSynonyms();
            });
            
            // Save new synonym
            $('#saveSynonymBtn').click(function() {
                const keyword = $('#synonymKeyword').val();
                const synonyms = $('#synonymList').val();
                
                if (!keyword || !synonyms) {
                    showError('Please fill in all fields');
                    return;
                }
                
                addSynonym(keyword, synonyms);
            });
            
            // Update existing synonym
            $('#updateSynonymBtn').click(function() {
                const id = $('#editSynonymId').val();
                const keyword = $('#editSynonymKeyword').val();
                const synonyms = $('#editSynonymList').val();
                
                if (!keyword || !synonyms) {
                    showError('Please fill in all fields');
                    return;
                }
                
                updateSynonym(id, keyword, synonyms);
            });
            
            // Confirm delete
            $('#confirmDeleteBtn').click(function() {
                const id = $('#deleteSynonymId').val();
                deleteSynonym(id);
            });
        });
        
        // Load all synonyms
        function loadSynonyms() {
            $.ajax({
                url: '/api/synonyms',
                type: 'GET',
                success: function(response) {
                    if (response.statusAPI === "OK") {
                        displaySynonyms(response.synonyms);
                    } else {
                        console.error('Error loading synonyms: API returned status', response.statusAPI);
                        showError('Failed to load synonyms');
                    }
                },
                error: function(xhr) {
                    console.error('Error loading synonyms:', xhr);
                    showError('Failed to load synonyms');
                }
            });
        }
        
        // Display synonyms in the table
        function displaySynonyms(synonyms) {
            const tableBody = $('#synonymTableBody');
            tableBody.empty();
            
            if (synonyms && synonyms.length > 0) {
                synonyms.forEach(function(synonym) {
                    tableBody.append(`
                        <tr>
                            <td>${synonym.synonym_name}</td>
                            <td>${synonym.synonym_value}</td>
                            <td class="action-buttons">
                                <button class="btn btn-sm btn-info edit-btn" data-id="${synonym.synonym_uuid}" 
                                    data-keyword="${synonym.synonym_name}" data-synonyms="${synonym.synonym_value}">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger delete-btn" data-id="${synonym.synonym_uuid}" 
                                    data-keyword="${synonym.synonym_name}">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    `);
                });
                
                // Add event listeners for edit and delete buttons
                addButtonEventListeners();
            } else {
                tableBody.append('<tr><td colspan="3" class="text-center">No synonyms found</td></tr>');
            }
        }
        
        // Add event listeners to the dynamically created buttons
        function addButtonEventListeners() {
            // Edit button click handler
            $('.edit-btn').click(function() {
                const id = $(this).data('id');
                const keyword = $(this).data('keyword');
                const synonyms = $(this).data('synonyms');
                
                $('#editSynonymId').val(id);
                $('#editSynonymKeyword').val(keyword);
                $('#editSynonymList').val(synonyms);
                
                $('#editSynonymModal').modal('show');
            });
            
            // Delete button click handler
            $('.delete-btn').click(function() {
                const id = $(this).data('id');
                const keyword = $(this).data('keyword');
                
                $('#deleteSynonymId').val(id);
                $('#deleteSynonymName').text(keyword);
                
                $('#deleteSynonymModal').modal('show');
            });
        }
        
        // Add a new synonym
        function addSynonym(keyword, synonyms) {
            $.ajax({
                url: '/api/rust_add_synonym',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    synonym_name: keyword,
                    synonym_value: synonyms,
                    comments: "Created from the web interface"
                }),
                success: function(response) {
                    if (response.statusAPI === "OK") {
                        $('#addSynonymModal').modal('hide');
                        $('#addSynonymForm')[0].reset();
                        showSuccess('Synonym added successfully');
                        loadSynonyms();
                    } else {
                        console.error('Error adding synonym: API returned status', response.statusAPI);
                        showError('Failed to add synonym');
                    }
                },
                error: function(xhr) {
                    console.error('Error adding synonym:', xhr);
                    showError('Failed to add synonym');
                }
            });
        }
        
        // Update an existing synonym
        function updateSynonym(id, keyword, synonyms) {
            $.ajax({
                url: '/api/rust_update_synonym',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    synonym_uuid: id,
                    synonym_name: keyword,
                    synonym_value: synonyms,
                    comments: "Updated from the web interface"
                }),
                success: function(response) {
                    if (response.statusAPI === "OK") {
                        $('#editSynonymModal').modal('hide');
                        showSuccess('Synonym updated successfully');
                        loadSynonyms();
                    } else {
                        console.error('Error updating synonym: API returned status', response.statusAPI);
                        showError('Failed to update synonym');
                    }
                },
                error: function(xhr) {
                    console.error('Error updating synonym:', xhr);
                    showError('Failed to update synonym');
                }
            });
        }
        
        // Delete a synonym
        function deleteSynonym(id) {
            $.ajax({
                url: '/api/rust_delete_synonym',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    synonym_uuid: id
                }),
                success: function(response) {
                    if (response.statusAPI === "OK") {
                        $('#deleteSynonymModal').modal('hide');
                        showSuccess('Synonym deleted successfully');
                        loadSynonyms();
                    } else {
                        console.error('Error deleting synonym: API returned status', response.statusAPI);
                        showError('Failed to delete synonym');
                    }
                },
                error: function(xhr) {
                    console.error('Error deleting synonym:', xhr);
                    showError('Failed to delete synonym');
                }
            });
        }
        
        // Show success message
        function showSuccess(message) {
            $('#successAlert').text(message);
            $('#successAlert').fadeIn().delay(3000).fadeOut();
        }
        
        // Show error message
        function showError(message) {
            $('#errorAlert').text(message);
            $('#errorAlert').fadeIn().delay(3000).fadeOut();
        }
    </script>
</body>
</html>